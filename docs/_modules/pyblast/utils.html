<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pyblast.utils &#8212; pyblastbio 0.4.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>
    


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          pyblast</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">pyblast <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer/api_reference.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer/api_reference.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for pyblast.utils</h1><div class="highlight"><pre>
<span></span>from .cmd import run_cmd
from Bio.Alphabet import generic_dna
from Bio.Seq import Seq
from glob import glob
from os.path import join
from Bio import SeqIO
from Bio.SeqRecord import SeqRecord
import tempfile
from Bio.SeqFeature import FeatureLocation, CompoundLocation
from pyblast.constants import Constants as C
from typing import List
from uuid import uuid4
from .span import Span, SpanError


<div class="viewcode-block" id="reverse_complement"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.reverse_complement">[docs]</a>def reverse_complement(seq_str: str) -&gt; str:
    &quot;&quot;&quot;
    Return reverse complement of nucleotide sequence

    :param seq_str:
    :type seq_str:
    :return:
    :rtype:
    &quot;&quot;&quot;
    return str(Seq(seq_str, generic_dna).reverse_complement())</div>


<div class="viewcode-block" id="complement"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.complement">[docs]</a>def complement(seq_str: str) -&gt; str:
    &quot;&quot;&quot;
    Return the complement of the nucleotide sequence.

    :param seq_str:
    :type seq_str:
    :return:
    :rtype:
    &quot;&quot;&quot;
    return str(Seq(seq_str, generic_dna).complement())</div>


<div class="viewcode-block" id="new_feature_location"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.new_feature_location">[docs]</a>def new_feature_location(start: int, end: int, length: int, strand: int):
    &quot;&quot;&quot;Makes a FeatureLocation. If necessary, makes CompoundLocation.&quot;&quot;&quot;
    if start &gt; end:
        if length is None:
            raise ValueError(
                &quot;A length must be provided to create a feature with start &gt; end.&quot;
            )
        f1 = FeatureLocation(start, length, strand)
        f2 = FeatureLocation(1, end, strand)
        if strand == -1:
            location = CompoundLocation([f2, f1])
        else:
            location = CompoundLocation([f1, f2])
    else:
        location = FeatureLocation(start, end, strand=strand)
    return location</div>


<div class="viewcode-block" id="records_to_tmpfile"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.records_to_tmpfile">[docs]</a>def records_to_tmpfile(records: List[SeqRecord]) -&gt; str:
    &quot;&quot;&quot;
    Write SeqRecords to a temporary file.

    :param records: list of SeqRecords
    :type records: list
    :return: temporary file path
    :rtype: str
    &quot;&quot;&quot;
    fd, tmp_path_handle = tempfile.mkstemp(suffix=&quot;.fasta&quot;)
    SeqIO.write(records, tmp_path_handle, format=&quot;fasta&quot;)
    return tmp_path_handle</div>


<div class="viewcode-block" id="glob_fasta_to_tmpfile"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.glob_fasta_to_tmpfile">[docs]</a>def glob_fasta_to_tmpfile(dirpath: str) -&gt; str:
    &quot;&quot;&quot;
    Concatenate all fasta files into a temporary fasta file.

    :param dirpath: directory containing fasta files
    :type dirpath: str
    :return: the temporary filename
    :rtype: str
    &quot;&quot;&quot;
    fasta_files = glob(join(dirpath, &quot;*.fsa&quot;))
    fasta_files += glob(join(dirpath, &quot;*.fasta&quot;))
    records = []
    for fsa in fasta_files:
        records += list(SeqIO.parse(fsa, &quot;fasta&quot;))
    return records_to_tmpfile(records)</div>


<div class="viewcode-block" id="_grouped_by_id"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils._grouped_by_id">[docs]</a>def _grouped_by_id(records):
    &quot;&quot;&quot;
    Return a dictionary of records grouped by their record_id
    :param records:
    :type records:
    :return:
    :rtype:
    &quot;&quot;&quot;
    rec_id_dict = {}
    for r in records:
        rec_id_dict.setdefault(r.id, list()).append(r)</div>


<div class="viewcode-block" id="force_unique_record_ids"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.force_unique_record_ids">[docs]</a>def force_unique_record_ids(records, use_uuid=False):
    &quot;&quot;&quot;
    Force unique ids for all records in the list

    :param records: list of SeqRecords
    :type records: list
    :param use_uuid: If True, will append a unique identifier to the front of the record id. Else, enumerate the
    records.
    :type use_uuid: bool
    :return: the records
    :rtype: list
    &quot;&quot;&quot;
    rec_id_dict = {}
    for r in records:
        rec_id_dict.setdefault(r.id, list()).append(r)
    for k, v in rec_id_dict.items():
        if len(v) &gt; 1:
            for i, r in enumerate(v):
                if use_uuid:
                    i = str(uuid4())
                r.id = &quot;({})__{}&quot;.format(i, r.id)
    return records</div>


<div class="viewcode-block" id="load_glob"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.load_glob">[docs]</a>def load_glob(
    path: str, format_str: str, recursive=False, force_unique_ids=False
) -&gt; List[SeqRecord]:
    &quot;&quot;&quot;
    Load SeqRecords from a glob-like path.

    :param path: glob-like filepath
    :type path: str
    :param format_str: Fileformat. e.g. &#39;genbank&#39;, &#39;fasta&#39;
    :type format_str: basestring
    :param recursive: whether to search recusively in the glob path.
    :type recursive: bool
    :param force_unique_ids: If True, force records to have unique ids
    :type force_unique_ids: bool
    :return: the list of SeqRecords
    :rtype: list
    &quot;&quot;&quot;
    records = []
    filenames = glob(path, recursive=recursive)
    for f in filenames:
        new_records = list(SeqIO.parse(f, format=format_str))
        for rec in new_records:
            rec.from_file = f
            records.append(rec)

    if force_unique_ids:
        force_unique_record_ids(records)
    return records</div>


<div class="viewcode-block" id="load_fasta_glob"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.load_fasta_glob">[docs]</a>def load_fasta_glob(path, recursive=False, force_unique_ids=False):
    &quot;&quot;&quot;
    Load SeqRecords from a glob-like path containing fasta files.

    :param path: glob-like filepath
    :type path: str
    :param recursive: whether to search recusively in the glob path.
    :type recursive: bool
    :param force_unique_ids: If True, force records to have unique ids
    :type force_unique_ids: bool
    :return: the list of SeqRecords
    :rtype: list
    &quot;&quot;&quot;
    return load_glob(
        path, &quot;fasta&quot;, recursive=recursive, force_unique_ids=force_unique_ids
    )</div>


<div class="viewcode-block" id="load_genbank_glob"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.load_genbank_glob">[docs]</a>def load_genbank_glob(path, recursive=False, force_unique_ids=False):
    &quot;&quot;&quot;
    Load SeqRecords from a glob-like path containing genbank files.

    :param path: glob-like filepath
    :type path: str
    :param recursive: whether to search recusively in the glob path.
    :type recursive: bool
    :param force_unique_ids: If True, force records to have unique ids
    :type force_unique_ids: bool
    :return: the list of SeqRecords
    :rtype: list
    &quot;&quot;&quot;
    records = load_glob(
        path, &quot;genbank&quot;, recursive=recursive, force_unique_ids=force_unique_ids
    )
    for r in records:
        if C.TOPOLOGY in r.annotations and r.annotations[C.TOPOLOGY] == C.CIRCULAR:
            r.annotations[C.CIRCULAR] = True
        else:
            r.annotations[C.CIRCULAR] = False
    return records</div>


<div class="viewcode-block" id="clean_records"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.clean_records">[docs]</a>def clean_records(records: List[SeqRecord]) -&gt; None:
    &quot;&quot;&quot;
    Remove features for records that have no location.
    &quot;&quot;&quot;
    for r in records:
        r.features = [f for f in r.features if f.location is not None]</div>


<div class="viewcode-block" id="is_circular"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.is_circular">[docs]</a>def is_circular(record: SeqRecord) -&gt; bool:
    &quot;&quot;&quot;
    Returns whether a &quot;topology&quot; annotation was found in the SeqRecord and
    whether this topolgy indicates that the sequence is circular.

    :param record: the SeqRecord
    :type record: SeqRecord
    :return: whether the SeqRecord is circular
    :rtype: bool
    &quot;&quot;&quot;
    annotations = {k.lower(): v for k, v in record.annotations.items()}
    return (
        annotations.get(C.CIRCULAR.lower(), False) is True
        or annotations.get(C.LINEAR.lower(), True) is False
        or annotations.get(C.TOPOLOGY.lower(), C.LINEAR).lower() == C.CIRCULAR.lower()
    )</div>


<div class="viewcode-block" id="make_linear"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.make_linear">[docs]</a>def make_linear(records: List[SeqRecord]) -&gt; List[SeqRecord]:
    &quot;&quot;&quot;
    Annotates the SeqRecords as linear by adding the &#39;topology&#39; annotation and
    setting it to &#39;linear&#39;

    :param records:
    :type records:
    :return: the records
    :rtype: list
    &quot;&quot;&quot;
    for r in records:
        if C.CIRCULAR in r.annotations:
            r.annotations[C.CIRCULAR] = False
        elif C.LINEAR in r.annotations:
            r.annotations[C.LINEAR] = True
        else:
            r.annotations[C.TOPOLOGY] = C.LINEAR
    return records</div>


<div class="viewcode-block" id="make_circular"><a class="viewcode-back" href="../../developer/_autosummary/pyblast.utils.html#pyblast.utils.make_circular">[docs]</a>def make_circular(records: List[SeqRecord]) -&gt; List[SeqRecord]:
    &quot;&quot;&quot;
    Annotates the SeqRecords as linear by adding the &#39;topology&#39; annotation and
    setting it to &#39;linear&#39;

    :param records:
    :type records:
    :return: the records
    :rtype: list
    &quot;&quot;&quot;
    for r in records:
        if C.CIRCULAR in r.annotations:
            r.annotations[C.CIRCULAR] = True
        elif C.LINEAR in r.annotations:
            r.annotations[C.LINEAR] = False
        else:
            r.annotations[C.TOPOLOGY] = C.CIRCULAR
    return records</div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2019, University of Washington.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>